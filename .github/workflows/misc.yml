name: Misc

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  package-lock-is-up-to-date:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v3
      with:
        node-version: 16
    - run: npm install --ignore-scripts
    - run: git diff --name-only --exit-code

  dist-is-up-to-date:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v3
      with:
        node-version: 16
    - run: npm clean-install
    - run: npm run dist:build
    - run: git diff --name-only --exit-code

  integration:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        version: [latest, master, v1.300.0]
        step: [version]
        # step: [version, npmExecuteScripts]
    steps:
    - uses: actions/checkout@v4
    - name: Run action to show Project Piper version
      uses: ./
      with:
        piper-version: ${{ matrix.version }}
        step-name: ${{ matrix.step }}
        flags: "--verbose --noTelemetry"
