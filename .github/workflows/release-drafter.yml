name: Draft Release

# yamllint disable-line rule:truthy
on:
  push:
    branches:
      - main

  pull_request:
    types: [opened, reopened, synchronize]

permissions:
  contents: read

jobs:
  update_release_draft:
    name: Release-Drafter
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: üèó Configure Release-Drafter
        run: |
          echo "GHE_HOST=${GITHUB_SERVER_URL##https:\/\/}" >> $GITHUB_ENV
      - name: üöÄ Prepare release
        uses: release-drafter/release-drafter@v6
        with:
          commitish: main  # codespell:ignore commitish
          disable-releaser: ${{ github.event_name == 'pull_request' }}
          disable-autolabeler: false
          name-template: 'v$RESOLVED_VERSION'
          tag-template: 'v$RESOLVED_VERSION'
          version-resolver: |
            major:
              labels:
                - major
                - breaking
            minor:
              labels:
                - minor
                - enhancement
            patch:
              labels:
                - patch
                - bug
                - dependencies
                - documentation
            default: patch
          categories: |
            - title: üö® Breaking Changes
              labels:
                - breaking
            - title: üöÄ Features
              labels:
                - enhancement
            - title: üêõ Bug Fixes
              labels:
                - bug
            - title: üß∞ Maintenance
              labels:
                - maintenance
                - ci
            - title: üìö Documentation
              labels:
                - documentation
            - title: ‚¨ÜÔ∏è Dependencies
              labels:
                - dependencies
          autolabeler: |
            - label: documentation
              files:
                - "*.md"
                - docs/**/*
              branch:
                - /docs{0,1}\/.+/
              title:
                - /docs/i
                - /documentation/i
            - label: bug
              branch:
                - /fix\/.+/
                - /bugfix\/.+/
              title:
                - /fix/i
                - /bug/i
                - /issue/i
            - label: enhancement
              branch:
                - /feature\/.+/
                - /enhancement\/.+/
                - /improve\/.+/
              title:
                - /feat/i
                - /feature/i
                - /enhance/i
                - /add/i
            - label: maintenance
              title:
                - /chore/i
            - label: dependencies
              files:
                - package.json
                - package-lock.json
                - yarn.lock
                - npm-shrinkwrap.json
              branch:
                - /deps\/.+/
              title:
                - /deps/i
                - /dependencies/i
                - /upgrade/i
            - label: breaking
              title:
                - /!:/i
                - /breaking/i
              body:
                - /BREAKING CHANGE:/i
          template: |
            ## What's Changed
            $CHANGES
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
